<!DOCTYPE html>
<html>
<body>
<style>
#radar {
  background: linear-gradient(#333, #111);
  box-shadow: 0 0 0 1px hsla(0, 0%, 0%, 0.5),
    inset 0 0 0 1px hsla(0, 0%, 100%, 0.15);
  padding: 14px;
  border-radius: 100%;
  display: block;
  left: 50%;
  position: absolute;
  top: 50%;
}
.center {
  position: absolute;
  width: 10px;
  height: 10px;
  border-radius: 50%;
  background-color: rgba(0,244,0,0.3);
   animation: pulse 2s infinite;
}

#radar .blip {
  width: 10px;
  height: 10px;
  background-color: rgba(255,0,0,0.5);
  position: absolute;
  border-radius: 50%;
 
}

@keyframes pulse {
  0% {
    transform: scale(1);
  }
  50% {
    transform: scale(1.5);
  }
  100% {
    transform: scale(1);
  }
}

.arrow {
  position: absolute;
  width: 0;
  height: 0;
  border-left: 5px solid transparent;
  border-right: 5px solid transparent;
  border-bottom: 10px solid black;
  left: 50%;
  top: -255%;
  transform: translate(-50%, -50%);
}
.arrow {
  transform: translate(-50%, -50%) rotate(0deg);
}

.pulse {
  position: absolute;
  width: 10px;
  height: 10px;
  border-radius: 50%;
  background-color: rgba(255, 0, 0, 0.5);
  transform: scale(0);
}
.pulse-expand {
  width: 400px;
  height: 400px;
  transition: all 1s ease-out;
}

.pulse-expand {
  animation: pulse 2s ease-out;
}

@keyframes pulse {
  to {
    transform: scale(50);
  }
}

.distance-label {
  position: absolute;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  display: none;
}


#bg {  
  background: radial-gradient(hsla(10, 20%, 20%, 0.5), hsla(10, 20%, 20%, 0.5));
  height: 100%;
  left: 0;
  position: absolute;
  width: 100%;
}


</style>
<div id="bg">
<div id="radar">
 <div class="arrow"></div>
  <div id="distance" class="blip"></div>
  <div class="center"></div>
 
</div></div>
<div ></div>

<script>
var arrow = document.querySelector(".arrow");


var distanceInPx = 50;
var distanceInKm = distanceInPx * 10 / 1000;

var radar = document.getElementById("radar");
radar.style.width = distanceInPx + "px";
radar.style.height = distanceInPx + "px";

  // Obtém a localização do usuário
  navigator.geolocation.getCurrentPosition(function(position) {
    var userLat = position.coords.latitude;
    var userLon = position.coords.longitude;

    // Define a localização da praça da sé
    var targetLat = -23.5975;
    var targetLon = -46.53611;

    // Calcula a distância entre as duas localizações
    var distance = calculateDistance(userLat, userLon, targetLat, targetLon);

    // Atualiza o radar com a distância calculada
    updateRadar(distance);

    // Atualiza o label com a distância calculada
    document.getElementById("distance").innerHTML = distance.toFixed(1) + "km";
var angle = Math.atan2(targetLat - userLat, targetLon - userLon);

  // Define o atributo transform da seta
arrow.setAttribute("transform", "rotate(0rad)");
arrow.setAttribute("transform", "rotate(" + angle + "rad)");

var angle = Math.atan2(targetLat - userLat, targetLon - userLon);
arrow.setAttribute("transform", "rotate(" + angle + "rad)");
var distance = calculateDistance(userLat, userLon, targetLat, targetLon) / 1000;

  });

function calculateDistance(lat1, lon1, lat2, lon2) {
  var R = 6371; // raio da Terra em km
  var dLat = (lat2 - lat1) * (Math.PI / 180);
  var dLon = (lon2 - lon1) * (Math.PI / 180);
  var a = 
    Math.sin(dLat / 2) * Math.sin(dLat / 2) +
    Math.cos(lat1 * (Math.PI / 180)) * Math.cos(lat2 * (Math.PI / 180)) * 
    Math.sin(dLon / 2) * Math.sin(dLon / 2)
    ; 
  var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a)); 
  var d = R * c;
  return d;
}

function updateRadar(distance) {
  // Obtém o elemento do radar
  var radar = document.getElementById("radar");

  // Obtém o elemento do "blip"
  var blip = radar.querySelector(".blip");

  // Atualiza a posição do "blip" baseado na distância calculada
  blip.style.left = (100 - (distance / 1000)) + "%";
  blip.style.top = (100 - (distance / 1000)) + "%";
}

</script>

</body>
</html>
